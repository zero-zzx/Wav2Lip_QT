## Wav2Lip解析

神经网络就是一种**通用函数近似器**。



## 算法

#### 模型：

Wav2Lip使用神经网络模型来实现音频与口型动作视频的同步。
具体来说，Wav2Lip使用了一种称为**条件生成对抗网络**（Conditional GAN）的模型。
该模型包含了两个主要的神经网络，即**生成器网络**和**判别器网络**。

生成器网络的作用是接受**音频信号**作为输入，然后生成对应的**口型动作视频**。
判别器网络的作用是接受**真实的口型动作视频和生成器生成的视频**作为输入，然后**判断哪一个是真实**的。



#### 训练过程：

具体来说，Wav2Lip GAN的训练过程包括两个阶段:

- **第一阶段，训练生成器，保持鉴别器不动**，让生成器尽可能地生成逼真的视频，使鉴别器难以区分生成的视频和真实视频；
- **第二阶段，训练鉴别器，固定生成器不动**，让鉴别器学习如何区分生成的视频和真实视频。





#### 模型结构：

生成器网络的输入包括两部分：**音频特征和嘴唇形状**。嘴唇形状(mask)是指一个二值图像，用于表示人脸的嘴唇区域，它的作用是让生成器能够学习到嘴唇的运动规律。生成器网络的输出是一个人脸视频序列，其中每一帧都对应着音频和嘴唇形状的信息。

鉴别器网络的输入是一个**视频帧序列**，它的作用是判断这个视频是否真实，输出一个0到1的实数表示视频的真实度。

具体来说，Wav2Lip GAN模型的生成器网络和鉴别器网络的结构如下：

- 生成器网络:

生成器网络包括三个主要部分: **音频特征提取网络**(Audio Feature Extractor), 嘴唇形状提取网络(Lip Region Extractor), 和**视频合成器**(Video Synthesizer)。其中，音频特征提取网络和嘴唇形状提取网络分别是一个基于卷积神经网络的特征提取器，用于从音频和嘴唇形状中提取特征。视频合成器是一个生成式网络，用于将音频和嘴唇形状的特征转换为对应的视频序列。

- 鉴别器网络:

鉴别器网络是一个基于卷积神经网络的**分类器，用于对输入的视频序列进行分类**。具体来说，它包括若干个卷积层、批标准化层和LeakyReLU激活函数层，最后经过一个全连接层输出一个0到1之间的实数，表示输入视频的真实度。

总的来说，Wav2Lip GAN模型的结构是一个典型的生成式对抗网络，通过不断地训练生成器和鉴别器网络，让生成器生成更加逼真的视频序列，鉴别器能够更加准确地区分生成的视频和真实视频。









## 模型文件

Wav2Lip 代码库中包含了四个预训练的模型文件，应该是**两个生成器**（“wav2lip.pth”和“wav2lip_gan.pth”）和**两个鉴别器**（“visual_quality_disc.pth”和“lipsync_expert.pth”）

其中，“wav2lip.pth”是一个基于**同步谱图(spectrogram)的生成器**，用于将音频转换为嘴唇运动。它的训练方式是直接优化生成的嘴唇运动和真实的嘴唇运动之间的差距。具体来说，这个模型输入的是一个音频和一个人脸图像，输出的是对应的人脸图像的嘴唇运动。这个模型的训练不需要GAN，也不需要嘴唇形状(mask)信息，因此训练数据集的标注成本相对较低。

而“wav2lip_gan.pth”是一个基于**条件GAN的生成器(generator)模型**，同样用于将音频转换为嘴唇运动。不同于上面那个模型，这个模型需要嘴唇形状(mask)信息，并且它的训练使用了GAN的方法。具体来说，这个模型输入的是一个音频和一个嘴唇形状(mask)，输出的是对应的人脸图像的嘴唇运动。这个模型的训练相对比较复杂，需要使用嘴唇形状(mask)信息以及GAN的方法，但是可以得到更加逼真的嘴唇运动。

鉴别器模型用于判断生成的视频是否真实。这个模型的输入是一个视频序列，输出的是一个0到1之间的实数，表示输入视频的真实度。是用于训练“wav2lip_gan.pth”模型的。





## 参数总量

在Wav2Lip项目中，作者使用了一种称为SyncNet的嘴唇追踪器模型和一种基于cGAN的语音到嘴唇同步器模型，两个模型的总训练参数量约为2300万。

具体来说，SyncNet模型具有约400万个训练参数，它的主要作用是将输入的音频与目标嘴唇视频之间的时间同步。语音到嘴唇同步器模型具有约1900万个训练参数，它的主要作用是将同步后的音频转换为具有逼真嘴唇运动的视频。







## 自己训练

有现成的训练脚本，需要准备数据集。